<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Lost Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #gameCanvas { position: relative; width: 600px; height: 400px; background: rgb(34, 139, 34); border: 4px solid #000; }
    #inventoryScreen { display: none; background: rgb(0, 0, 0); color: white; padding: 20px; }
    .item { display: flex; align-items: center; margin-bottom: 10px; }
    canvas { position: absolute; }
  </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
  <div class="container mx-auto p-4 max-w-3xl">
    <h1 class="text-3xl font-bold text-center mb-4">The Lost Explorer</h1>
    <div id="gameCanvas" class="mx-auto mb-4 rounded-lg shadow-lg"></div>
    <button id="inventoryButton" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mb-4">View Inventory</button>
    <div id="inventoryScreen" class="bg-gray-800 p-6 rounded-lg shadow-lg mb-4"></div>
    <div id="story" class="bg-gray-800 p-6 rounded-lg shadow-lg mb-4"></div>
    <div id="choices" class="flex flex-col gap-2"></div>
    <button id="restart" class="mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded hidden">Restart Adventure</button>
  </div>
  <script>
    let playerState = { inventory: [], trustPoints: 0 };
    let animationFrame;

    const storyData = {
      start: {
        text: "In Eldoria’s jungle, you seek the Temple of Zorath. A sage named Elara stands by a glowing treasure. She offers guidance. What do you say?",
        choices: [
          { text: "Ask about the temple", next: "ask_temple" },
          { text: "Inquire about her scroll", next: "sage_quest" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Elara", class: "sage", x: 100, y: 300, z: 2 },
          { name: "Treasure", class: "treasure", x: 200, y: 320, z: 1 }
        ]
      },
      sage_quest: {
        text: "Elara says, 'I lost my sacred scroll in the ruins. Find it, and I’ll guide you.' Accept her quest?",
        choices: [
          { text: "Accept quest", next: "ruins_search", effect: { trustPoints: 1 } },
          { text: "Decline and ask about temple", next: "ask_temple" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Elara", class: "sage", x: 100, y: 300, z: 2 }
        ]
      },
      ask_temple: {
        text: "Elara says, 'The temple is across the river. Trust me for a map.' Trust her?",
        choices: [
          { text: "Trust Elara", next: "trust_sage", effect: { trustPoints: 1, inventory: "map" } },
          { text: "Distrust and explore alone", next: "explore_alone" },
          { text: "Ask about scroll", next: "sage_quest" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Elara", class: "sage", x: 100, y: 300, z: 2 }
        ]
      },
      explore_alone: {
        text: "You leave Elara and reach a river. A rival explorer, Kael, appears, demanding a duel for a relic. Fight or negotiate?",
        choices: [
          { text: "Fight Kael", next: "fight_kael" },
          { text: "Negotiate", next: "negotiate_kael", effect: { trustPoints: 1 } }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Kael", class: "rival", x: 300, y: 310, z: 2 }
        ]
      },
      fight_kael: {
        text: "You fight Kael but lose. He takes your gear. Trust points save you, reverting to the river. Try again?",
        choices: [
          { text: "Try again", next: "explore_alone", effect: { trustPoints: -1 } },
          { text: "Give up", next: "game_over" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Kael", class: "rival", x: 300, y: 310, z: 2 }
        ],
        gameOver: true
      },
      negotiate_kael: {
        text: "Kael agrees to share the relic if you find his lost dagger in the ruins. Accept his quest?",
        choices: [
          { text: "Accept quest", next: "ruins_search", effect: { trustPoints: 1 } },
          { text: "Decline and cross river", next: "cross_river" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Kael", class: "rival", x: 300, y: 310, z: 2 }
        ]
      },
      cross_river: {
        text: "You cross the river via a rickety bridge. It holds, but a guardian spirit, Lira, demands an offering. Offer an item or fight?",
        choices: [
          { text: "Offer item", next: "offer_item", condition: { inventory: "scroll" } },
          { text: "Fight Lira", next: "fight_lira" },
          { text: "Run back", next: "explore_alone" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Lira", class: "spirit", x: 200, y: 300, z: 2 }
        ]
      },
      offer_item: {
        text: "Lira accepts the scroll, granting you safe passage to the ruins. You proceed.",
        choices: [
          { text: "Enter ruins", next: "ruins_entry", effect: { inventory: "-scroll" } }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Lira", class: "spirit", x: 200, y: 300, z: 2 }
        ]
      },
      fight_lira: {
        text: "You fight Lira but are overwhelmed. Trust points save you, reverting to the river. Try again?",
        choices: [
          { text: "Try again", next: "cross_river", effect: { trustPoints: -1 } },
          { text: "Give up", next: "game_over" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Lira", class: "spirit", x: 200, y: 300, z: 2 }
        ],
        gameOver: true
      },
      ruins_search: {
        text: "In the ruins, you find Elara’s scroll and Kael’s dagger behind traps. Take one or both?",
        choices: [
          { text: "Take scroll", next: "take_scroll", effect: { inventory: "scroll" } },
          { text: "Take dagger", next: "take_dagger", effect: { inventory: "dagger" } },
          { text: "Take both", next: "take_both", effect: { inventory: ["scroll", "dagger"] } }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Scroll", class: "scroll", x: 200, y: 320, z: 1 },
          { name: "Dagger", class: "dagger", x: 250, y: 320, z: 1 }
        ]
      },
      take_scroll: {
        text: "You take the scroll. Return it to Elara or keep exploring?",
        choices: [
          { text: "Return to Elara", next: "return_scroll", effect: { trustPoints: 1 } },
          { text: "Explore ruins", next: "ruins_entry" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 }
        ]
      },
      take_dagger: {
        text: "You take the dagger. Return it to Kael or keep exploring?",
        choices: [
          { text: "Return to Kael", next: "return_dagger", effect: { trustPoints: 1 } },
          { text: "Explore ruins", next: "ruins_entry" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 }
        ]
      },
      take_both: {
        text: "You take both items but trigger a trap! Trust points save you, reverting to ruins. Try again?",
        choices: [
          { text: "Try again", next: "ruins_search", effect: { trustPoints: -1 } },
          { text: "Give up", next: "game_over" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Trap", class: "trap", x: 250, y: 350, z: 1 }
        ],
        gameOver: true
      },
      return_scroll: {
        text: "Elara thanks you, giving a map. You head to the temple.",
        choices: [
          { text: "Follow map", next: "temple_entry", effect: { inventory: ["map", "-scroll"] } }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Elara", class: "sage", x: 100, y: 300, z: 2 }
        ]
      },
      return_dagger: {
        text: "Kael shares the relic, boosting your strength. You head to the temple.",
        choices: [
          { text: "Enter temple", next: "temple_entry", effect: { inventory: ["relic", "-dagger"] } }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Kael", class: "rival", x: 300, y: 310, z: 2 }
        ]
      },
      ruins_entry: {
        text: "The ruins hide the temple’s entrance. Solve a puzzle or search for treasure?",
        choices: [
          { text: "Solve puzzle", next: "puzzle", condition: { inventory: "map" } },
          { text: "Search for treasure", next: "treasure_trap" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 }
        ]
      },
      puzzle: {
        text: "Using the map, you solve the puzzle and find the temple entrance.",
        choices: [
          { text: "Enter temple", next: "temple_entry" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 }
        ]
      },
      treasure_trap: {
        text: "Greed triggers a spike trap! Game over unless trust points remain.",
        choices: [
          { text: "Try again", next: "ruins_entry", effect: { trustPoints: -1 } },
          { text: "Give up", next: "game_over" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Trap", class: "trap", x: 250, y: 350, z: 1 }
        ],
        gameOver: true
      },
      temple_entry: {
        text: "You reach the Temple of Zorath. A statue glows. Take it or leave it?",
        choices: [
          { text: "Take statue", next: "take_statue", condition: { inventory: "relic" } },
          { text: "Leave it", next: "leave_temple" }
        ],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Statue", class: "statue", x: 300, y: 200, z: 1 }
        ]
      },
      take_statue: {
        text: "The relic protects you. You claim the statue and win!",
        choices: [],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 },
          { name: "Statue", class: "statue", x: 300, y: 200, z: 1 }
        ]
      },
      leave_temple: {
        text: "You leave empty-handed but alive. Your adventure ends.",
        choices: [],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 }
        ]
      },
      game_over: {
        text: "No trust points remain. Your adventure ends in failure.",
        choices: [],
        sprites: [
          { name: "You", class: "player", x: 50, y: 310, z: 3 }
        ]
      }
    };

    const inventoryItems = {
      map: { description: "A tattered map to the Temple of Zorath.", sprite: "map" },
      scroll: { description: "Elara’s sacred scroll, glowing faintly.", sprite: "scroll" },
      dagger: { description: "Kael’s sharp dagger, etched with runes.", sprite: "dagger" },
      relic: { description: "A protective relic shared by Kael.", sprite: "relic" }
    };

    function drawSprite(ctx, sprite, frame) {
      ctx.save();
      ctx.translate(sprite.x, sprite.y + Math.sin(frame / 10) * 5); // Bounce animation
      ctx.fillStyle = {
        player: "rgb(0, 0, 255)", // Blue Mario-like character
        sage: "rgb(139, 69, 19)", // Brown robe
        rival: "rgb(255, 0, 0)", // Red for rival
        spirit: "rgb(200, 200, 255)", // Light blue for spirit
        treasure: "rgb(255, 215, 0)", // Gold
        scroll: "rgb(255, 255, 200)", // Creamy scroll
        dagger: "rgb(169, 169, 169)", // Silver dagger
        relic: "rgb(128, 0, 128)", // Purple relic
        statue: "rgb(192, 192, 192)", // Silver statue
        trap: "rgb(128, 128, 128)" // Gray spikes
      }[sprite.class];
      // Pixel-art style: body, outline, details
      if (sprite.class === "player") {
        ctx.fillRect(0, 0, 30, 50); // Body
        ctx.fillStyle = "rgb(255, 220, 177)"; // Face
        ctx.fillRect(10, 5, 10, 10); // Face pixel
        ctx.fillStyle = "rgb(0, 0, 0)"; // Eyes
        ctx.fillRect(12, 7, 2, 2); ctx.fillRect(16, 7, 2, 2);
      } else if (sprite.class === "sage") {
        ctx.fillRect(0, 0, 50, 80); // Robe
        ctx.fillStyle = "rgb(255, 220, 177)"; // Face
        ctx.fillRect(15, 5, 20, 15);
      } else if (sprite.class === "rival") {
        ctx.fillRect(0, 0, 40, 60); // Body
        ctx.fillStyle = "rgb(0, 0, 0)"; // Hat
        ctx.fillRect(10, 0, 20, 10);
      } else if (sprite.class === "spirit") {
        ctx.fillRect(0, 0, 40, 60); // Ethereal body
        ctx.fillStyle = "rgb(255, 255, 255)"; // Glow
        ctx.fillRect(10, 10, 20, 20);
      } else if (sprite.class === "treasure" || sprite.class === "statue") {
        ctx.fillRect(0, 0, 40, 40); // Square base
        ctx.fillStyle = "rgb(255, 255, 255)"; // Shine
        ctx.fillRect(5, 5, 10, 10);
      } else if (sprite.class === "scroll") {
        ctx.fillRect(0, 0, 30, 20); // Scroll
        ctx.fillStyle = "rgb(0, 0, 0)"; // Lines
        ctx.fillRect(5, 5, 20, 2);
      } else if (sprite.class === "dagger") {
        ctx.fillRect(0, 0, 10, 30); // Blade
        ctx.fillStyle = "rgb(139, 69, 19)"; // Handle
        ctx.fillRect(2, 30, 6, 10);
      } else if (sprite.class === "relic") {
        ctx.fillRect(0, 0, 20, 20); // Relic
        ctx.fillStyle = "rgb(255, 255, 255)"; // Gem
        ctx.fillRect(5, 5, 10, 10);
      } else if (sprite.class === "trap") {
        ctx.fillRect(0, 0, 60, 20); // Spikes
        ctx.fillStyle = "rgb(255, 255, 255)"; // Tips
        ctx.fillRect(10, 0, 10, 5); ctx.fillRect(30, 0, 10, 5);
      }
      // Name above sprite
      ctx.fillStyle = "white";
      ctx.font = "12px Arial";
      ctx.fillText(sprite.name, 0, -10);
      ctx.restore();
    }

    function displayScene(sceneKey) {
      const scene = storyData[sceneKey];
      document.getElementById("story").innerText = scene.text;
      const choicesDiv = document.getElementById("choices");
      choicesDiv.innerHTML = "";
      const canvas = document.createElement("canvas");
      canvas.width = 600;
      canvas.height = 400;
      document.getElementById("gameCanvas").innerHTML = "";
      document.getElementById("gameCanvas").appendChild(canvas);
      const ctx = canvas.getContext("2d");

      let frame = 0;
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        scene.sprites.forEach(sprite => drawSprite(ctx, sprite, frame));
        frame++;
        animationFrame = requestAnimationFrame(animate);
      }
      cancelAnimationFrame(animationFrame);
      animate();

      if (scene.choices.length === 0 || (scene.gameOver && playerState.trustPoints <= 0)) {
        document.getElementById("restart").classList.remove("hidden");
      } else {
        scene.choices.forEach(choice => {
          if (!choice.condition || (choice.condition.inventory && playerState.inventory.includes(choice.condition.inventory)) || (choice.condition.health)) {
            const button = document.createElement("button");
            button.innerText = choice.text;
            button.classList.add("bg-blue-600", "hover:bg-blue-700", "text-white", "font-bold", "py-2", "px-4", "rounded");
            button.onclick = () => {
              if (choice.effect) {
                if (choice.effect.trustPoints) playerState.trustPoints = Math.min(3, Math.max(0, playerState.trustPoints + choice.effect.trustPoints));
                if (choice.effect.inventory) {
                  if (Array.isArray(choice.effect.inventory)) {
                    choice.effect.inventory.forEach(item => {
                      if (item.startsWith("-")) playerState.inventory = playerState.inventory.filter(i => i !== item.slice(1));
                      else playerState.inventory.push(item);
                    });
                  } else if (choice.effect.inventory.startsWith("-")) {
                    playerState.inventory = playerState.inventory.filter(i => i !== choice.effect.inventory.slice(1));
                  } else {
                    playerState.inventory.push(choice.effect.inventory);
                  }
                }
              }
              displayScene(choice.next);
            };
            choicesDiv.appendChild(button);
          }
        });
      }
    }

    function showInventory() {
      const inventoryScreen = document.getElementById("inventoryScreen");
      inventoryScreen.style.display = "block";
      inventoryScreen.innerHTML = "<h2 class='text-xl font-bold mb-2'>Inventory</h2>";
      playerState.inventory.forEach(item => {
        const itemDiv = document.createElement("div");
        itemDiv.className = "item";
        const canvas = document.createElement("canvas");
        canvas.width = 40;
        canvas.height = 40;
        const ctx = canvas.getContext("2d");
        drawSprite(ctx, { class: inventoryItems[item].sprite, x: 0, y: 0, name: "" }, 0);
        itemDiv.appendChild(canvas);
        itemDiv.innerHTML += `<span class='ml-2'>${item}: ${inventoryItems[item].description}</span>`;
        inventoryScreen.appendChild(itemDiv);
      });
      inventoryScreen.innerHTML += `<p>Trust Points: ${playerState.trustPoints}</p>`;
      document.getElementById("inventoryButton").innerText = "Hide Inventory";
      document.getElementById("inventoryButton").onclick = hideInventory;
    }

    function hideInventory() {
      document.getElementById("inventoryScreen").style.display = "none";
      document.getElementById("inventoryButton").innerText = "View Inventory";
      document.getElementById("inventoryButton").onclick = showInventory;
    }

    document.getElementById("inventoryButton").onclick = showInventory;
    document.getElementById("restart").onclick = () => {
      playerState = { inventory: [], trustPoints: 0 };
      document.getElementById("restart").classList.add("hidden");
      displayScene("start");
    };

    displayScene("start");
  </script>
</body>
</html>
